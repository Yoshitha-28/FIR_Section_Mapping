<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIR Legal Analysis System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .loading {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        // Icons temporarily disabled due to compatibility issues
        // const { Upload, FileText, BookOpen, Scale, AlertCircle, CheckCircle, Loader } = lucide;

        const FIRLegalRAGSystem = () => {
          const [step, setStep] = useState(1);
          const [uploadedFile, setUploadedFile] = useState(null);
          const [ocrText, setOcrText] = useState('');
          const [mappedSections, setMappedSections] = useState({ bns: [], bnss: [] });
          const [isProcessing, setIsProcessing] = useState(false);
          const [analysisLog, setAnalysisLog] = useState([]);
          const [cacheHit, setCacheHit] = useState(false);
          const [caseDatabase, setCaseDatabase] = useState({});
          const [firSummary, setFirSummary] = useState('');
          const [firHash, setFirHash] = useState('');
          const [apiKey, setApiKey] = useState('');
          const [showApiKeyInput, setShowApiKeyInput] = useState(false);

          // Initialize cache from localStorage
          useEffect(() => {
            const savedCases = localStorage.getItem('firCases');
            if (savedCases) {
              setCaseDatabase(JSON.parse(savedCases));
            }
            const savedApiKey = localStorage.getItem('gemmaApiKey');
            if (savedApiKey) {
              setApiKey(savedApiKey);
            }
          }, []);

          const log = (message, type = 'info') => {
            setAnalysisLog(prev => [...prev, { 
              time: new Date().toLocaleTimeString(), 
              message,
              type 
            }]);
          };

          // Simple hash function for FIR content
          const generateHash = (text) => {
            let hash = 0;
            for (let i = 0; i < text.length; i++) {
              const char = text.charCodeAt(i);
              hash = ((hash << 5) - hash) + char;
              hash = hash & hash;
            }
            return Math.abs(hash).toString(36);
          };

          const handleFileUpload = async (e) => {
            const file = e.target.files[0];
            if (file) {
              setUploadedFile(file);
              setIsProcessing(true);
              
              setTimeout(() => {
                const sampleOCR = `I am writing to report a very serious incident that happened to me last night. On the night of September 27th around 11:30 PM, I was sleeping in my house with my family when suddenly I heard a loud noise. Three men broke the lock of my main door and entered my house. They were carrying weapons - one had a knife and another had a stick.

They came inside and started shouting at us. They threatened us saying they would hurt us badly if we did not give them money and gold. I was very scared. When I told them I do not have much money, one of them became angry and hit me on my head with the stick. I fell down and got hurt on my arms too. My head was bleeding.

Then they searched my house and took all the cash I had saved - about fifty thousand rupees from my cupboard. They also took my wife gold necklace, bangles and earrings which were worth around two lakh rupees. They even took my mobile phone. While leaving, they broke my TV and damaged other household items.

They threatened us not to tell anyone or they would come back and hurt us more. Then they ran away from the house. I immediately called my neighbor for help. We informed the police. I had to go to hospital for treatment of my head injury.

This incident has traumatized my entire family. My children are very scared. I request the police to catch these criminals and take strict action against them. I want justice and I want my belongings back. Please help us.`;
                
                setOcrText(sampleOCR);
                setIsProcessing(false);
                setStep(2);
              }, 2000);
            }
          };

          const checkCacheForSimilarCase = async (text) => {
            log('Checking cache for similar cases...', 'info');
            
            const hash = generateHash(text.toLowerCase().replace(/\s+/g, ''));
            setFirHash(hash);
            
            // Check if exact or very similar case exists in cache
            if (caseDatabase[hash]) {
              log('✓ Cache hit! Found identical case analysis', 'success');
              setCacheHit(true);
              return caseDatabase[hash];
            }
            
            // Check for semantic similarity using keywords
            const keywords = text.toLowerCase().match(/\b\w{4,}\b/g) || [];
            const keywordSet = new Set(keywords);
            
            for (const [cachedHash, cachedData] of Object.entries(caseDatabase)) {
              const cachedKeywords = new Set(cachedData.keywords || []);
              const intersection = new Set([...keywordSet].filter(x => cachedKeywords.has(x)));
              const similarity = intersection.size / Math.max(keywordSet.size, cachedKeywords.size);
              
              if (similarity > 0.7) {
                log(`✓ Found similar case in cache (${Math.round(similarity * 100)}% match)`, 'success');
                setCacheHit(true);
                return cachedData;
              }
            }
            
            log('No similar cases found in cache. Performing full analysis...', 'info');
            return null;
          };

          const callGemma = async (prompt, maxTokens = 1000) => {
            if (!apiKey) {
              throw new Error('API key not configured. Please add your Google AI Studio API key.');
            }

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-001:generateContent?key=${apiKey}`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                contents: [{
                  parts: [{
                    text: `You are a legal expert specializing in Indian criminal law, specifically the Bharatiya Nyaya Sanhita (BNS) 2023 and Bharatiya Nagarik Suraksha Sanhita (BNSS) 2023. Provide accurate, detailed legal analysis.

${prompt}`
                  }]
                }],
                generationConfig: {
                  maxOutputTokens: maxTokens,
                  temperature: 0.3,
                  topP: 0.8,
                  topK: 40
                }
              })
            });

            if (!response.ok) {
              const error = await response.json();
              throw new Error(`Google AI API Error: ${error.error?.message || 'Unknown error'}`);
            }

            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
          };

          const analyzeWithAI = async () => {
            setIsProcessing(true);
            setAnalysisLog([]);
            setCacheHit(false);
            
            log('Starting automated legal analysis...', 'info');
            
            // Check cache first
            const cachedResult = await checkCacheForSimilarCase(ocrText);
            
            if (cachedResult) {
              setTimeout(() => {
                setFirSummary(cachedResult.summary);
                setMappedSections(cachedResult.sections);
                setIsProcessing(false);
                setStep(3);
              }, 1000);
              return;
            }
            
            try {
              // Step 1: Summarize the FIR
              log('Step 1/4: Generating FIR summary...', 'info');
              await new Promise(resolve => setTimeout(resolve, 1000));
              
              const summaryPrompt = `Analyze this FIR and provide a brief summary of the incident in 2-3 sentences, focusing on the key criminal acts:

FIR TEXT:
${ocrText}

Respond with ONLY the summary, nothing else.`;

              let summary;
              if (apiKey) {
                summary = await callGemma(summaryPrompt, 200);
              } else {
                summary = "Three armed men broke into victim's house, assaulted him with weapons, threatened the family, stole cash and gold jewelry worth 2.5 lakh rupees, and damaged property before fleeing.";
                log('⚠ Using simulated analysis (no API key provided)', 'warning');
              }
              
              setFirSummary(summary);
              log(`✓ Summary generated: "${summary.substring(0, 100)}..."`, 'success');
              
              // Step 2: Analyze against BNS
              log('Step 2/4: Analyzing against BNS (Bharatiya Nyaya Sanhita)...', 'info');
              await new Promise(resolve => setTimeout(resolve, 1000));
              
              const bnsPrompt = `You are a legal expert analyzing an FIR against the Bharatiya Nyaya Sanhita (BNS) 2023.

FIR SUMMARY: ${summary}
FULL FIR TEXT: ${ocrText}

TASK: Analyze this FIR and identify ALL applicable sections from BNS 2023. Consider:
- Offences against human body (murder, hurt, assault, wrongful restraint, kidnapping)
- Offences against property (theft, robbery, dacoity, extortion, criminal breach of trust, cheating, mischief, criminal trespass, house-breaking)
- Sexual offences (rape, sexual harassment, outraging modesty)
- Offences against public tranquility (rioting, unlawful assembly, criminal intimidation)
- Document offences (forgery, using forged documents)

For EACH applicable section, provide:
1. Section number
2. Offence name
3. Brief description of why it applies
4. Punishment prescribed

Respond in this EXACT JSON format with NO other text:
{
  "sections": [
    {
      "section": "103",
      "offense": "Murder",
      "description": "Why this section applies to the FIR",
      "punishment": "Death or life imprisonment",
      "relevance": "high"
    }
  ]
}`;

              let bnsSections;
              if (apiKey) {
                const bnsResponse = await callGemma(bnsPrompt, 2000);
                try {
                  const bnsJson = JSON.parse(bnsResponse);
                  bnsSections = bnsJson.sections || [];
                } catch (parseError) {
                  log('⚠ Error parsing BNS response, using fallback', 'warning');
                  bnsSections = getFallbackBNSSections();
                }
              } else {
                bnsSections = getFallbackBNSSections();
              }
              
              log(`✓ Found ${bnsSections.length} applicable BNS sections`, 'success');
              
              // Step 3: Analyze against BNSS
              log('Step 3/4: Analyzing against BNSS (Bharatiya Nagarik Suraksha Sanhita)...', 'info');
              await new Promise(resolve => setTimeout(resolve, 1000));
              
              const bnssPrompt = `You are a legal expert analyzing procedural requirements for an FIR under BNSS 2023.

FIR SUMMARY: ${summary}
IDENTIFIED BNS SECTIONS: ${bnsSections.map(s => `Section ${s.section} - ${s.offense}`).join(', ')}

TASK: Identify ALL applicable procedural sections from BNSS 2023 for this case. Consider:
- FIR registration procedures (Section 173)
- Investigation procedures (Section 176)
- Arrest provisions (Sections 35-46)
- Search and seizure (Sections 47-56)
- Cognizable/non-cognizable classification (Section 2)
- Bail provisions (Sections 479-482)
- Charge framing (Section 230)
- Trial procedures (Sections 268-294)
- Victim compensation (Section 385)
- Witness/victim protection (Section 397)

For EACH applicable section, provide:
1. Section number
2. Title
3. Description of what it covers
4. Why it applies to this case

Respond in this EXACT JSON format with NO other text:
{
  "sections": [
    {
      "section": "173",
      "title": "Information in cognizable cases",
      "description": "Police to register FIR for cognizable offences",
      "applicableWhy": "Why this applies to this case"
    }
  ]
}`;

              let bnssSections;
              if (apiKey) {
                const bnssResponse = await callGemma(bnssPrompt, 1500);
                try {
                  const bnssJson = JSON.parse(bnssResponse);
                  bnssSections = bnssJson.sections || [];
                } catch (parseError) {
                  log('⚠ Error parsing BNSS response, using fallback', 'warning');
                  bnssSections = getFallbackBNSSSections();
                }
              } else {
                bnssSections = getFallbackBNSSSections();
              }
              
              log(`✓ Found ${bnssSections.length} applicable BNSS sections`, 'success');
              
              // Step 4: Cache the results
              log('Step 4/4: Caching results for future retrieval...', 'info');
              
              const keywords = ocrText.toLowerCase().match(/\b\w{4,}\b/g) || [];
              const cacheEntry = {
                summary: summary,
                sections: {
                  bns: bnsSections,
                  bnss: bnssSections
                },
                keywords: [...new Set(keywords)],
                timestamp: new Date().toISOString()
              };
              
              // Save to cache
              const newCaseDatabase = {...caseDatabase};
              newCaseDatabase[firHash] = cacheEntry;
              setCaseDatabase(newCaseDatabase);
              localStorage.setItem('firCases', JSON.stringify(newCaseDatabase));
              
              log(`✓ Analysis complete! Results cached with ID: ${firHash.substring(0, 8)}`, 'success');
              
              setMappedSections({ bns: bnsSections, bnss: bnssSections });
              setIsProcessing(false);
              setStep(3);
              
            } catch (error) {
              log(`✗ Error during analysis: ${error.message}`, 'error');
              console.error('Analysis error:', error);
              setIsProcessing(false);
            }
          };

          const getFallbackBNSSections = () => [
            {
              section: "309",
              offense: "Robbery",
              description: "Armed robbery with force involving weapons and threats",
              punishment: "Rigorous imprisonment up to 10 years and fine",
              relevance: "high"
            },
            {
              section: "331",
              offense: "House-breaking",
              description: "Breaking into house by force (breaking lock)",
              punishment: "Imprisonment up to 2 years and fine",
              relevance: "high"
            },
            {
              section: "115",
              offense: "Voluntarily Causing Hurt",
              description: "Physical assault causing injury to head and arms",
              punishment: "Imprisonment up to 1 year or fine up to 10,000 or both",
              relevance: "high"
            },
            {
              section: "303",
              offense: "Theft",
              description: "Dishonest taking of cash, gold jewelry, and mobile phone",
              punishment: "Imprisonment up to 3 years or fine or both",
              relevance: "high"
            },
            {
              section: "351",
              offense: "Criminal Intimidation",
              description: "Threatening victims not to report to police",
              punishment: "Imprisonment up to 2 years or fine or both",
              relevance: "high"
            },
            {
              section: "324",
              offense: "Mischief",
              description: "Damaging household items (TV and other property)",
              punishment: "Imprisonment up to 3 months or fine or both",
              relevance: "medium"
            }
          ];

          const getFallbackBNSSSections = () => [
            {
              section: "173",
              title: "Information in cognizable cases",
              description: "Police officer to register FIR for cognizable offences",
              applicableWhy: "Case involves cognizable offences (robbery, house-breaking, assault)"
            },
            {
              section: "176",
              title: "Investigation by police",
              description: "Police to investigate and collect evidence",
              applicableWhy: "Full investigation required for serious cognizable offences"
            },
            {
              section: "35-46",
              title: "Arrest without warrant",
              description: "Police can arrest accused without warrant in cognizable cases",
              applicableWhy: "Cognizable offences - immediate arrest powers applicable"
            },
            {
              section: "47-56",
              title: "Search and Seizure",
              description: "Powers to search premises and seize stolen property/weapons",
              applicableWhy: "Need to recover stolen items and seize weapons used"
            },
            {
              section: "2(c)",
              title: "Cognizable offence",
              description: "Offences where police can act without magistrate warrant",
              applicableWhy: "Robbery and house-breaking are cognizable offences"
            },
            {
              section: "230",
              title: "Framing of charge",
              description: "Formal charges to be framed against accused",
              applicableWhy: "Multiple charges need to be framed for trial"
            },
            {
              section: "268-294",
              title: "Trial procedure",
              description: "Recording of evidence and witness examination",
              applicableWhy: "Standard trial procedure for all criminal cases"
            },
            {
              section: "397",
              title: "Witness and victim protection",
              description: "Protection measures for threatened witnesses/victims",
              applicableWhy: "Victim was threatened not to report - protection needed"
            },
            {
              section: "385",
              title: "Compensation to victims",
              description: "Court can order compensation for injuries and losses",
              applicableWhy: "Victim suffered physical injuries and property loss"
            }
          ];

          return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-blue-50 p-6" },
            React.createElement('div', { className: "max-w-7xl mx-auto" },
              React.createElement('div', { className: "bg-white rounded-xl shadow-xl p-8 mb-6 border-t-4 border-indigo-600" },
                React.createElement('div', { className: "flex items-center justify-between mb-4" },
                  React.createElement('div', { className: "flex items-center gap-4" },
                    React.createElement('div', { className: "bg-indigo-100 p-3 rounded-lg" }),
                    React.createElement('div', null,
                      React.createElement('h1', { className: "text-4xl font-bold text-gray-800" }, "Automated FIR Legal Analysis"),
                      React.createElement('p', { className: "text-gray-600 mt-1" }, "AI-powered RAG system with intelligent caching")
                    )
                  ),
                  React.createElement('div', { className: "flex items-center gap-3" },
                    React.createElement('div', { className: "flex items-center gap-3 bg-green-50 px-4 py-2 rounded-lg border border-green-200" },
                      React.createElement('div', null,
                        React.createElement('p', { className: "text-xs text-green-600 font-semibold" }, "Cached Cases"),
                        React.createElement('p', { className: "text-lg font-bold text-green-700" }, Object.keys(caseDatabase).length)
                      )
                    ),
                    React.createElement('button', {
                      onClick: () => setShowApiKeyInput(!showApiKeyInput),
                      className: "bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center gap-2"
                    },
                      "Gemini API Key"
                    )
                  )
                ),
                
                showApiKeyInput && React.createElement('div', { className: "bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6" },
                  React.createElement('div', { className: "flex items-center gap-3 mb-3" },
                    React.createElement('h3', { className: "text-lg font-semibold text-blue-900" }, "Google Gemini API Configuration")
                  ),
                  React.createElement('div', { className: "flex gap-3" },
                    React.createElement('input', {
                      type: "password",
                      placeholder: "Enter your Google AI Studio API key",
                      value: apiKey,
                      onChange: (e) => setApiKey(e.target.value),
                      className: "flex-1 px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    }),
                    React.createElement('button', {
                      onClick: () => {
                        localStorage.setItem('geminiApiKey', apiKey);
                        setShowApiKeyInput(false);
                        log('✓ API key saved successfully', 'success');
                      },
                      className: "bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
                    }, "Save")
                  ),
                  React.createElement('p', { className: "text-sm text-blue-700 mt-2" }, 
                    "Get your API key from ", 
                    React.createElement('a', { 
                      href: "https://aistudio.google.com/app/apikey", 
                      target: "_blank", 
                      className: "underline hover:text-blue-900" 
                    }, "Google AI Studio")
                  )
                ),
                
                React.createElement('div', { className: "bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6" },
                    React.createElement('div', { className: "flex items-start gap-3" },
                    React.createElement('div', { className: "text-sm text-blue-800" },
                      React.createElement('p', { className: "font-semibold mb-1" }, "AI-Powered Analysis"),
                      React.createElement('p', null, 
                        apiKey ? "Using Google Gemini 1.5 Flash for real-time legal analysis" : 
                        "Using simulated analysis (add API key for real AI analysis)"
                      )
                    )
                  )
                ),
                
                React.createElement('div', { className: "flex justify-between mt-8" },
                  [
                    { num: 1, label: 'Upload FIR' },
                    { num: 2, label: 'AI Analysis' },
                    { num: 3, label: 'Results' }
                  ].map((s) =>
                    React.createElement('div', { key: s.num, className: "flex flex-col items-center flex-1" },
                      React.createElement('div', { 
                        className: `w-14 h-14 rounded-full flex items-center justify-center transition-all ${
                          step >= s.num ? 'bg-indigo-600 text-white shadow-lg' : 'bg-gray-200 text-gray-500'
                        }`
                      },
                        null
                      ),
                      React.createElement('span', { 
                        className: `text-sm mt-3 font-medium ${step >= s.num ? 'text-indigo-600' : 'text-gray-500'}`
                      }, s.label)
                    )
                  )
                )
              ),

              step === 1 && React.createElement('div', { className: "bg-white rounded-xl shadow-xl p-8" },
                React.createElement('h2', { className: "text-2xl font-bold mb-6 text-gray-800 flex items-center gap-3" },
                  "Upload Handwritten FIR Document"
                ),
                React.createElement('div', { className: "border-4 border-dashed border-indigo-300 rounded-xl p-16 text-center bg-indigo-50/50 hover:bg-indigo-50 transition" },
                  React.createElement('div', { className: "w-20 h-20 text-indigo-400 mx-auto mb-6" }),
                  React.createElement('p', { className: "text-gray-600 mb-2 text-lg" }, "Drop your scanned FIR here or click to browse"),
                  React.createElement('p', { className: "text-gray-500 text-sm mb-6" }, "Supports: Images (JPG, PNG) and PDF files"),
                  React.createElement('label', { className: "bg-indigo-600 text-white px-8 py-4 rounded-lg cursor-pointer hover:bg-indigo-700 transition inline-block text-lg font-medium shadow-lg" },
                    "Choose File",
                    React.createElement('input', { 
                      type: "file", 
                      className: "hidden", 
                      accept: "image/*,.pdf", 
                      onChange: handleFileUpload 
                    })
                  ),
                  uploadedFile && React.createElement('div', { className: "mt-6 text-green-600 flex items-center justify-center gap-3 bg-green-50 p-4 rounded-lg" },
                    React.createElement('span', { className: "font-medium" }, `${uploadedFile.name} uploaded successfully`)
                  )
                )
              ),

              step === 2 && React.createElement('div', { className: "space-y-6" },
                React.createElement('div', { className: "bg-white rounded-xl shadow-xl p-8" },
                React.createElement('h2', { className: "text-2xl font-bold mb-6 text-gray-800 flex items-center gap-3" },
                  "Digitized FIR Text"
                  ),
                  React.createElement('div', { className: "bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-lg mb-6 border border-gray-200 max-h-96 overflow-y-auto" },
                    React.createElement('p', { className: "text-gray-700 leading-relaxed whitespace-pre-wrap" }, ocrText)
                  ),

                  React.createElement('button', {
                    onClick: analyzeWithAI,
                    disabled: isProcessing,
                    className: "bg-indigo-600 text-white px-8 py-4 rounded-lg hover:bg-indigo-700 transition flex items-center gap-3 text-lg font-medium shadow-lg disabled:bg-gray-400 disabled:cursor-not-allowed"
                  },
                    isProcessing ? "Analyzing with AI..." : (apiKey ? "Start AI Analysis" : "Start Analysis (Simulated)")
                  ),

                  analysisLog.length > 0 && React.createElement('div', { className: "mt-6 bg-gray-900 rounded-lg p-4 text-green-400 font-mono text-sm max-h-64 overflow-y-auto" },
                    analysisLog.map((log, idx) =>
                      React.createElement('div', { 
                        key: idx, 
                        className: `mb-1 ${
                          log.type === 'success' ? 'text-green-400' : 
                          log.type === 'warning' ? 'text-yellow-400' : 
                          log.type === 'error' ? 'text-red-400' : 
                          'text-blue-400'
                        }`
                      },
                        React.createElement('span', { className: "text-gray-500" }, `[${log.time}]`),
                        ` ${log.message}`
                      )
                    )
                  )
                )
              ),

              step === 3 && React.createElement('div', { className: "space-y-6" },
                cacheHit && React.createElement('div', { className: "bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-300 rounded-xl p-6" },
                  React.createElement('div', { className: "flex items-start gap-4" },
                    React.createElement('div', null,
                      React.createElement('h3', { className: "text-xl font-bold text-green-900 mb-2" }, "Cache Hit - Instant Results!"),
                      React.createElement('p', { className: "text-gray-700" }, "Found similar case in database. Retrieved results instantly without re-analysis.")
                    )
                  )
                ),

                React.createElement('div', { className: "bg-white rounded-xl shadow-xl p-8" },
                  React.createElement('h2', { className: "text-2xl font-bold mb-4 text-gray-800 flex items-center gap-3" },
                    "FIR Summary"
                  ),
                  React.createElement('div', { className: "bg-indigo-50 border border-indigo-200 rounded-lg p-4" },
                    React.createElement('p', { className: "text-gray-800 leading-relaxed" }, firSummary)
                  )
                ),

                React.createElement('div', { className: "bg-white rounded-xl shadow-xl p-8" },
                  React.createElement('div', { className: "flex items-center justify-between mb-6" },
                    React.createElement('h2', { className: "text-2xl font-bold text-gray-800 flex items-center gap-3" },
                      "BNS Sections (Bharatiya Nyaya Sanhita)"
                    ),
                    React.createElement('span', { className: "bg-purple-100 text-purple-800 px-4 py-2 rounded-full font-bold" },
                      `${mappedSections.bns.length} Sections`
                    )
                  ),
                  
                  React.createElement('div', { className: "space-y-4" },
                    mappedSections.bns.map((section, idx) =>
                      React.createElement('div', { key: idx, className: "border-2 border-purple-200 rounded-lg p-6 hover:shadow-lg transition bg-gradient-to-r from-purple-50 to-white" },
                        React.createElement('div', { className: "flex items-start justify-between mb-3" },
                          React.createElement('div', { className: "flex-1" },
                            React.createElement('div', { className: "flex items-center gap-3 mb-2" },
                              React.createElement('span', { className: "bg-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold" },
                                `Section ${section.section}`
                              ),
                              React.createElement('span', { 
                                className: `px-3 py-1 rounded-full text-xs font-semibold ${
                                  section.relevance === 'high' ? 'bg-red-100 text-red-800' :
                                  section.relevance === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                                  'bg-blue-100 text-blue-800'
                                }`
                              }, `${(section.relevance || 'MEDIUM').toUpperCase()} Relevance`)
                            ),
                            React.createElement('h3', { className: "text-xl font-bold text-purple-900 mb-2" }, section.offense),
                            React.createElement('p', { className: "text-gray-700 mb-3" }, section.description),
                            
                            React.createElement('div', { className: "bg-red-50 border border-red-200 rounded-lg p-3" },
                              React.createElement('p', { className: "text-sm font-semibold text-red-800" }, "Punishment:"),
                              React.createElement('p', { className: "text-sm text-red-700" }, section.punishment)
                            )
                          ),
                          
                          React.createElement('div', { className: "ml-4" },
                            React.createElement('div', { className: "bg-purple-600 text-white w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg" },
                              idx + 1
                            )
                          )
                        )
                      )
                    )
                  )
                ),

                React.createElement('div', { className: "bg-white rounded-xl shadow-xl p-8" },
                  React.createElement('div', { className: "flex items-center justify-between mb-6" },
                    React.createElement('h2', { className: "text-2xl font-bold text-gray-800 flex items-center gap-3" },
                      "BNSS Sections (Bharatiya Nagarik Suraksha Sanhita)"
                    ),
                    React.createElement('span', { className: "bg-green-100 text-green-800 px-4 py-2 rounded-full font-bold" },
                      `${mappedSections.bnss.length} Sections`
                    )
                  ),
                  
                  React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                    mappedSections.bnss.map((section, idx) =>
                      React.createElement('div', { key: idx, className: "border-2 border-green-200 rounded-lg p-5 hover:shadow-lg transition bg-gradient-to-br from-green-50 to-white" },
                        React.createElement('div', { className: "flex items-start gap-3 mb-3" },
                          React.createElement('div', { className: "bg-green-600 text-white px-3 py-1 rounded-lg text-sm font-bold whitespace-nowrap" },
                            `§${section.section}`
                          ),
                          React.createElement('h3', { className: "text-lg font-bold text-green-900" }, section.title)
                        ),
                        
                        React.createElement('p', { className: "text-gray-700 text-sm mb-3" }, section.description),
                        
                        React.createElement('div', { className: "bg-green-100 rounded-lg p-3" },
                          React.createElement('p', { className: "text-xs font-semibold text-green-800 mb-1" }, "Why Applicable:"),
                          React.createElement('p', { className: "text-xs text-green-700" }, section.applicableWhy)
                        )
                      )
                    )
                  )
                ),

                React.createElement('div', { className: "bg-gradient-to-r from-green-50 to-blue-50 border-2 border-green-300 rounded-xl p-6" },
                  React.createElement('div', { className: "flex items-start gap-4" },
                    React.createElement('div', null,
                      React.createElement('h3', { className: "text-xl font-bold text-green-900 mb-2" }, "Analysis Complete!"),
                      React.createElement('p', { className: "text-gray-700 mb-4" },
                        `AI has automatically analyzed the FIR and identified ${mappedSections.bns.length} applicable BNS sections and ${mappedSections.bnss.length} relevant BNSS procedural provisions.`
                      ),
                      React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-3 text-sm" },
                        [
                          "Automated section identification",
                          "Intelligent relevance scoring",
                          "Results cached for future retrieval",
                          "Ready for legal documentation"
                        ].map((item, idx) =>
                          React.createElement('div', { key: idx, className: "flex items-start gap-2" },
                            React.createElement('span', { className: "text-green-600 font-bold" }, "✓"),
                            React.createElement('span', { className: "text-gray-700" }, item)
                          )
                        )
                      )
                    )
                  )
                ),

                React.createElement('div', { className: "flex gap-4" },
                  React.createElement('button', {
                    onClick: () => {
                      setStep(1);
                      setUploadedFile(null);
                      setOcrText('');
                      setMappedSections({ bns: [], bnss: [] });
                      setAnalysisLog([]);
                      setCacheHit(false);
                      setFirSummary('');
                    },
                    className: "bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition flex items-center gap-2"
                  },
                    
                    "Process Another FIR"
                  ),
                  
                  React.createElement('button', {
                    onClick: () => {
                      const report = `AUTOMATED FIR LEGAL ANALYSIS REPORT
Generated: ${new Date().toLocaleString()}
Cache Status: ${cacheHit ? 'Retrieved from cache' : 'Fresh analysis'}
Analysis ID: ${firHash}
API Used: ${apiKey ? 'Google Gemma 1.5 Flash' : 'Simulated Analysis'}

FIR SUMMARY:
${firSummary}

APPLICABLE BNS SECTIONS (${mappedSections.bns.length}):
${mappedSections.bns.map((s, i) => `
${i + 1}. Section ${s.section} - ${s.offense}
   Relevance: ${s.relevance?.toUpperCase() || 'MEDIUM'}
   Description: ${s.description}
   Punishment: ${s.punishment}
`).join('\n')}

APPLICABLE BNSS SECTIONS (${mappedSections.bnss.length}):
${mappedSections.bnss.map((s, i) => `
${i + 1}. Section ${s.section} - ${s.title}
   Description: ${s.description}
   Why Applicable: ${s.applicableWhy}
`).join('\n')}

---
This report was generated by an AI-powered automated legal analysis system.
All sections were identified by analyzing the complete BNS and BNSS documents.
`;
                      
                      const blob = new Blob([report], { type: 'text/plain' });
                      const url = URL.createObjectURL(blob);
                      const a = document.createElement('a');
                      a.href = url;
                      a.download = `fir-analysis-${firHash.substring(0, 8)}.txt`;
                      a.click();
                      URL.revokeObjectURL(url);
                    },
                    className: "bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition flex items-center gap-2"
                  },
                    
                    "Download Report"
                  ),
                  
                  React.createElement('button', {
                    onClick: () => {
                      alert(`Analysis cached with ID: ${firHash}\n\nTotal cached cases: ${Object.keys(caseDatabase).length}\n\nThis case will be instantly retrieved if a similar FIR is analyzed in the future.`);
                    },
                    className: "bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition flex items-center gap-2"
                  },
                    
                    "View Cache Info"
                  )
                )
              )
            )
          );
        };

        // Add error handling
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.error);
            document.getElementById('root').innerHTML = '<div style="padding: 20px; color: red;"><h1>Error Loading App</h1><p>Check console for details: ' + e.message + '</p></div>';
        });

        try {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(React.createElement(FIRLegalRAGSystem));
        } catch (error) {
            console.error('React Error:', error);
            document.getElementById('root').innerHTML = '<div style="padding: 20px; color: red;"><h1>React Error</h1><p>' + error.message + '</p></div>';
        }
    </script>
</body>
</html>